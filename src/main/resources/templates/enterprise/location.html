<!doctype html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:th="http://www.thymeleaf.org"
	  layout:decorate="~{layout/default}">
<head>
	<meta charset="UTF-8">
	<meta name="viewport"
		  content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>펫시터의 이름</title>
	<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c2c4e06dc64e84c36fa8af04a0f00306&libraries=services"></script>
	<link rel="stylesheet" href="/css/kakao-map.css">
	<style>
		#mapwrap{position:relative;overflow:hidden;}
		.category, .category *{margin:0;padding:0;color:#000;}
		.category {position:absolute;overflow:hidden;top:10px;left:10px;width:200px;height:50px;z-index:10;border:1px solid black;font-family:'Malgun Gothic','맑은 고딕',sans-serif;font-size:12px;text-align:center;background-color:#fff;}
		.category .menu_selected {background:#FF5F4A;color:#fff;border-left:1px solid #915B2F;border-right:1px solid #915B2F;margin:0 -1px;}
		.category li{list-style:none;float:left;width:66px;height:45px;padding-top:5px;cursor:pointer;}
		.category .ico_comm {display:block;margin:0 auto 2px;width:22px;height:26px;background-size: contain; background-repeat: no-repeat;}
		.category .ico_hospital {background-image:url('https://cdn-icons-png.flaticon.com/128/2749/2749678.png');}  /* 병원 아이콘 URL */
		.category .ico_pharmacy {background-image:url('https://cdn-icons-png.flaticon.com/128/4320/4320344.png');}  /* 약국 아이콘 URL */
		.category .ico_hairsalon {background-image:url('https://cdn-icons-png.flaticon.com/128/1057/1057470.png');}  /* 미용실 아이콘 URL */
	</style>
</head>
<body>

<div layout:fragment="main" class="page-body">
	<div class="container">
<!--		<a th:href="@{/enterprise/hospitalreview}">리뷰페이지</a>-->
		<h3>위치 찾기</h3>
		<div id="mapwrap">
			<!-- 지도가 표시될 div -->
			<div id="map" style="width:100%;height:350px;"></div>
			<!-- 지도 위에 표시될 마커 카테고리 -->
			<div class="category">
				<ul>
					<li id="hospitalMenu" onclick="changeMarker('hospital')">
						<span class="ico_comm ico_hospital"></span>
						병원
					</li>
					<li id="pharmacyMenu" onclick="changeMarker('pharmacy')">
						<span class="ico_comm ico_pharmacy"></span>
						약국
					</li>
					<li id="hairsalonMenu" onclick="changeMarker('hairsalon')">
						<span class="ico_comm ico_hairsalon"></span>
						미용실
					</li>
				</ul>
			</div>
		</div>
	</div>

	<script>
		var mapContainer = document.getElementById('map'), // 지도를 표시할 div
				mapOption = {
					center: new kakao.maps.LatLng(37.498004414546934, 127.02770621963765), // 지도의 중심좌표
					level: 3 // 지도의 확대 레벨
				};

		var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

		// 병원 마커가 표시될 좌표 배열입니다
		var hospitalPositions = [
			new kakao.maps.LatLng(37.499590490909185, 127.0263723554437),
			new kakao.maps.LatLng(37.499427948430814, 127.02794423197847),
			new kakao.maps.LatLng(37.498553760499505, 127.02882598822454)
		];

		// 약국 마커가 표시될 좌표 배열입니다
		var pharmacyPositions = [
			new kakao.maps.LatLng(37.497535461505684, 127.02948149502778),
			new kakao.maps.LatLng(37.49671536281186, 127.03020491448352),
			new kakao.maps.LatLng(37.496201943633714, 127.02959405469642)
		];

		// 미용실 마커가 표시될 좌표 배열입니다
		var hairsalonPositions = [
			new kakao.maps.LatLng(37.49966168796031, 127.03007039430118),
			new kakao.maps.LatLng(37.499463762912974, 127.0288828824399),
			new kakao.maps.LatLng(37.49896834100913, 127.02833986892401)
		];


		var hospitalMarkers = [], // 병원 마커 객체를 가지고 있을 배열입니다
				pharmacyMarkers = [], // 약국 마커 객체를 가지고 있을 배열입니다
				hairsalonMarkers = []; // 미용실 마커 객체를 가지고 있을 배열입니다


		createHospitalMarkers(); // 병원 마커를 생성하고 병원 마커 배열에 추가합니다
		createPharmacyMarkers(); // 약국 마커를 생성하고 약국 마커 배열에 추가합니다
		createHairsalonMarkers(); // 미용실 마커를 생성하고 미용실 마커 배열에 추가합니다

		changeMarker('hospital'); // 지도에 병원 마커가 보이도록 설정합니다


		// 마커이미지의 주소와, 크기, 옵션으로 마커 이미지를 생성하여 리턴하는 함수입니다
		function createMarkerImage(src, size, options) {
			var markerImage = new kakao.maps.MarkerImage(src, size, options);
			return markerImage;
		}


		// 좌표와 마커이미지를 받아 마커를 생성하여 리턴하는 함수입니다
		function createMarker(position, image) {
			var marker = new kakao.maps.Marker({
				position: position,
				image: image
			});

			return marker;
		}

		// 인포윈도우를 생성하는 함수
		function createInfoWindow(content) {
			var infowindow = new kakao.maps.InfoWindow({
				content: content // 인포윈도우에 표시할 내용
			});
			return infowindow;
		}

		// 병원 마커를 생성하고 병원 마커 배열에 추가하는 함수입니다
		function createHospitalMarkers() {
			for (var i = 0; i < hospitalPositions.length; i++) {
				var imageSize = new kakao.maps.Size(24, 35), // 마커 이미지 크기
						imageOptions = {offset: new kakao.maps.Point(12, 35)}; // 마커 이미지의 위치 옵션

				// 병원 마커 이미지 생성
				var markerImage = createMarkerImage('https://cdn-icons-png.flaticon.com/128/3448/3448513.png', imageSize, imageOptions),
						marker = createMarker(hospitalPositions[i], markerImage);

				// 생성된 마커를 병원 마커 배열에 추가합니다
				hospitalMarkers.push(marker);

				// 인포윈도우에 표시할 내용
				var content = `
            <div style="padding:5px;">
                병원 #${i+1}
                <a href="/enterprise/hospitalreview">리뷰페이지</a><br>
                <button onclick="closeInfoWindow(${i}, 'hospital')">닫기</button>
            </div>`;
				var infowindow = createInfoWindow(content);

				// 마커에 클릭 이벤트를 등록합니다
				kakao.maps.event.addListener(marker, 'click', makeClickListener(map, marker, infowindow));

				// 각 인포윈도우를 배열에 저장
				hospitalMarkers[i].infowindow = infowindow;
			}
		}

		// 약국 마커를 생성하고 약국 마커 배열에 추가하는 함수입니다
		function createPharmacyMarkers() {
			for (var i = 0; i < pharmacyPositions.length; i++) {
				var imageSize = new kakao.maps.Size(24, 35), // 마커 이미지 크기
						imageOptions = {offset: new kakao.maps.Point(12, 35)}; // 마커 이미지의 위치 옵션

				// 약국 마커 이미지 생성
				var markerImage = createMarkerImage('https://cdn-icons-png.flaticon.com/128/4287/4287703.png', imageSize, imageOptions),
						marker = createMarker(pharmacyPositions[i], markerImage);

				pharmacyMarkers.push(marker);

				// 인포윈도우에 표시할 내용
				var content = `
            <div style="padding:5px;">
                약국 #${i+1}
                <a href="/enterprise/hospitalreview">리뷰페이지</a><br>
                <button onclick="closeInfoWindow(${i}, 'pharmacy')">닫기</button>
            </div>`;
				var infowindow = createInfoWindow(content);

				// 마커에 클릭 이벤트를 등록합니다
				kakao.maps.event.addListener(marker, 'click', makeClickListener(map, marker, infowindow));

				// 각 인포윈도우를 배열에 저장
				pharmacyMarkers[i].infowindow = infowindow;
			}
		}

		// 미용실 마커를 생성하고 미용실 마커 배열에 추가하는 함수입니다
		function createHairsalonMarkers() {
			for (var i = 0; i < hairsalonPositions.length; i++) {
				var imageSize = new kakao.maps.Size(24, 35), // 마커 이미지 크기
						imageOptions = {offset: new kakao.maps.Point(12, 35)}; // 마커 이미지의 위치 옵션

				// 미용실 마커 이미지 생성
				var markerImage = createMarkerImage('https://cdn-icons-png.flaticon.com/128/11060/11060796.png', imageSize, imageOptions),
						marker = createMarker(hairsalonPositions[i], markerImage);

				hairsalonMarkers.push(marker);

				// 인포윈도우에 표시할 내용
				var content = `
            <div style="padding:5px;">
                미용실 #${i+1}
                <a href="/enterprise/hospitalreview">리뷰페이지</a><br>
                <button onclick="closeInfoWindow(${i}, 'hairsalon')">닫기</button>
            </div>`;
				var infowindow = createInfoWindow(content);

				// 마커에 클릭 이벤트를 등록합니다
				kakao.maps.event.addListener(marker, 'click', makeClickListener(map, marker, infowindow));

				// 각 인포윈도우를 배열에 저장
				hairsalonMarkers[i].infowindow = infowindow;
			}
		}

		// 클릭 이벤트가 발생했을 때 인포윈도우를 열어주는 함수
		function makeClickListener(map, marker, infowindow) {
			return function() {
				infowindow.open(map, marker);
			};
		}

		// 인포윈도우를 닫는 함수
		function closeInfoWindow(index, type) {
			if (type === 'hospital') {
				hospitalMarkers[index].infowindow.close();
			} else if (type === 'pharmacy') {
				pharmacyMarkers[index].infowindow.close();
			} else if (type === 'hairsalon') {
				hairsalonMarkers[index].infowindow.close();
			}
		}

		// 병원 마커들의 지도 표시 여부를 설정하는 함수입니다
		function setHospitalMarkers(map) {
			for (var i = 0; i < hospitalMarkers.length; i++) {
				hospitalMarkers[i].setMap(map);
			}
		}

		// 약국 마커들의 지도 표시 여부를 설정하는 함수입니다
		function setPharmacyMarkers(map) {
			for (var i = 0; i < pharmacyMarkers.length; i++) {
				pharmacyMarkers[i].setMap(map);
			}
		}

		// 미용실 마커들의 지도 표시 여부를 설정하는 함수입니다
		function setHairsalonMarkers(map) {
			for (var i = 0; i < hairsalonMarkers.length; i++) {
				hairsalonMarkers[i].setMap(map);
			}
		}

		// 카테고리를 클릭했을 때 type에 따라 카테고리의 스타일과 지도에 표시되는 마커를 변경합니다
		function changeMarker(type){

			var hospitalMenu = document.getElementById('hospitalMenu');
			var pharmacyMenu = document.getElementById('pharmacyMenu');
			var hairsalonMenu = document.getElementById('hairsalonMenu');

			// 병원 카테고리가 클릭됐을 때
			if (type === 'hospital') {

				// 병원 카테고리를 선택된 스타일로 변경하고
				hospitalMenu.className = 'menu_selected';

				// 약국과 미용실 카테고리는 선택되지 않은 스타일로 바꿉니다
				pharmacyMenu.className = '';
				hairsalonMenu.className = '';

				// 병원 마커들만 지도에 표시하도록 설정합니다
				setHospitalMarkers(map);
				setPharmacyMarkers(null);
				setHairsalonMarkers(null);

			} else if (type === 'pharmacy') { // 약국 카테고리가 클릭됐을 때

				// 약국 카테고리를 선택된 스타일로 변경하고
				hospitalMenu.className = '';
				pharmacyMenu.className = 'menu_selected';
				hairsalonMenu.className = '';

				// 약국 마커들만 지도에 표시하도록 설정합니다
				setHospitalMarkers(null);
				setPharmacyMarkers(map);
				setHairsalonMarkers(null);

			} else if (type === 'hairsalon') { // 미용실 카테고리가 클릭됐을 때

				// 미용실 카테고리를 선택된 스타일로 변경하고
				hospitalMenu.className = '';
				pharmacyMenu.className = '';
				hairsalonMenu.className = 'menu_selected';

				// 미용실 마커들만 지도에 표시하도록 설정합니다
				setHospitalMarkers(null);
				setPharmacyMarkers(null);
				setHairsalonMarkers(map);
			}
		}
	</script>
	</div>
</body>
</html>
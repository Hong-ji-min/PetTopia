<!DOCTYPE html>
<html layout:decorate="~{layout/default}" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <title>주소 검색 및 예약 정보</title>
    <style>
        .page-body {
            display: flex;
            justify-content: space-between; /* 자식 요소 간의 여백을 고르게 분배 */
            flex-wrap: wrap;
            align-items: flex-start;
            width: 80%;
            height: 1500px;
            margin: 10px auto;
            padding: 30px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .reservation-details {
            width: 45%; /* 너비 설정 */
            background: #d4edda; /* 배경색 */
            padding: 20px; /* 내부 여백 */
            border-radius: 8px; /* 테두리 둥글게 */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* 그림자 효과 */
            text-align: center; /* 텍스트 왼쪽 정렬 */
            line-height: 1.6; /* 줄 간격 */
        }

        .petProfile {
            width: 40%;
            text-align: center;
        }

        .petProfile img {
            width: 100%;
            height: auto;
            border-radius: 8px;
        }

        .map-spot {
            position: absolute;
            width: 40%;
            text-align: center;
            bottom: 20px;
            right: 20px;
        }

        .map-spot #map {
            width: 100%;
            height: 350px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }


        .comment-section {
            width: 55%; /* 댓글 섹션의 너비를 부모 요소의 45%로 설정*/
            background: #f8f9fa; /* 배경색 */
            padding: 30px; /* 댓글 섹션 안의 콘텐츠와 경계선 사이에 20 픽셀의 여백을 추가함*/
            border-radius: 8px; /* 테두리 둥글게 */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* 그림자 효과 */
            margin-top: 10px; /* 댓글 섹션의 위쪽 10픽셀의 여백을 추가하여 다른 요소와의 간격을 둠  */
            height: 800px;
        }

        .comment-section h3 {
            margin-bottom: 20px;
        }

        .comment-section textarea {
            width: 100%;
            height: 80px;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ced4da;
            margin-bottom: 10px;
        }

        .comment-section button {
            width: 100%;
            padding: 10px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .comment-section button:hover {
            background-color: #218838;
        }

        .comment-list {
            margin-top: 20px;
        }

        .comment-list div {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

 <div class="page-body" layout:fragment="main">
    <!-- 예약 정보 표시 영역 -->
    <section class="reservation-details">
        <input type="hidden" id="addressInput" th:value="${detail.address}">
        <h2><strong>🐶우리 강아지를 돌봐주세요🐶</strong></h2>
        <p>이름: <span th:text="${detail.petName}"></span></p>
        <p>강아지 성격: <span th:text="${detail.petSociability}"></span></p>
        <p>강아지 출생일: <span th:text="${detail.petBirth}"></span></p>
        <p>견종: <span th:text="${detail.petBreed}"></span></p>
        <p>강아지 크기: <span th:text="${detail.petSize}"></span></p>
        <p>예박 접종: <span th:text="${detail.petVaccinationType}"></span></p>
        <p>기생충 예방 접종: <span th:text="${detail.petParasitePrevention}"></span></p>
        <p>예약 종료요청 날짜: <input type="date" th:value="${detail.startDate}" readonly></p>
        <p>예약 요청 날짜: <input type="date" th:value="${detail.endDate}" readonly></p>
        <p>예약 서비스: <span th:text="${detail.requestService}"></span></p>
        <div class="update-box">
            <button class="btnForUpdate" th:if="${isWriter}" th:onclick="|location.href = '@{/petsitterfinder/detailupdate(postId=${detail.postId})}'|">수정</button>
        </div>
    </section>

    <!-- 펫 프로필 영역 -->
    <section class="petProfile">
        <h2>☺️우리 강아지에요☺️</h2>
        <img src="/images/KakaoTalk_20240527_201110282.jpg" alt="강아지 사진">
    </section>

    <!-- 지도 표시 영역 -->
    <section class="map-spot">
        <h2>🏠이 근처에 살아요🏠</h2>
        <div id="map"></div>
    </section>

    <!-- 댓글 섹션 -->
<!--     작성자가 입력한 값이 commentContents.value 를 Script로 받아줌
         로그인 한 회원의 이름과 memberId 값이 넘어가도록 함

-->

    <section class="comment-section">
        <h3>댓글 작성</h3>
        <textarea placeholder="댓글을 입력하세요..." id="commentContents" name="commentContents"></textarea>
        <input type="hidden" name="commentWriter" id="commentWriter" th:value="${memberInfo.name}">
        <input type="hidden" name="memberId" id="memberId" th:value="${memberInfo.id}">
        <button id="comment-write-btn" onclick="commentWrite()">댓글 작성</button>

        <div class="comment-list">
            <div>작성된 댓글 1</div>
            <div>작성된 댓글 2</div>
        </div>
    </section>
     <script>
<!--         작성된 값을 컨트롤러로 보내야함 ajax이용-->
         const commentWrite = () => {
             const contents = document.getElementById("commentContents").value;
             const writer = document.getElementById("commentWriter").value;
             const memberId = document.getElementById("memberId").value;
             const postId = [[${detail.postId}]]
             console.log(contents)
             console.log(writer)
             console.log(memberId)
             console.log(postId)
             $.ajax({
                 // 요청 방식: post, 요청주소: /comment/save, 요청데이터: 작성내용, 작성자, 게시글 번호( 어떤 게시글에 대한 댓글인지 알기 위함임)

                 type: "post",
                 url: "/comment/save",
                 data: {
                     "commentContents": contents,
                     "commentWriter":writer,
                     "memberId": memberId,
                     "postId": postId

                 },
                 // AJAX 요청이 완료되었을 때 실행되는 콜백 함수임.
                 success: function (res){
                     console.log("요청 성공", res);
                 },
                 error: function (err){
                     console.log("요청 실패", err);
                 }


             });
         }
     </script>


<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c2c4e06dc64e84c36fa8af04a0f00306&libraries=services"></script>
<script>
    var mapContainer = document.getElementById('map'),
        mapOption = {
            center: new kakao.maps.LatLng(33.450701, 126.570667),
            level: 2
        };

    var map = new kakao.maps.Map(mapContainer, mapOption);
    var geocoder = new kakao.maps.services.Geocoder();
    var marker = new kakao.maps.Marker({ map: map });
    var infowindow = new kakao.maps.InfoWindow();

    function searchAddress() {
        var address = document.getElementById('addressInput').value;

        geocoder.addressSearch(address, function(result, status) {
            if (status === kakao.maps.services.Status.OK) {
                var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                marker.setPosition(coords);
                infowindow.setContent('<div style="width:150px;text-align:center;padding:6px 0;">' + address + '</div>');
                infowindow.open(map, marker);
                map.setCenter(coords);
            } else {
                infowindow.close();
                marker.setMap(null);
            }
            var circle = new kakao.maps.Circle({
                center: new kakao.maps.LatLng(result[0].y, result[0].x),
                radius: 30,
                strokeWeight: 5,
                strokeColor: '#75B8FA',
                strokeOpacity: 1,
                strokeStyle: 'dashed',
                fillColor: '#CFE7FF',
                fillOpacity: 0.4
            });
            circle.setMap(map);
        });
    }

    document.addEventListener('DOMContentLoaded', searchAddress);
</script>
 </div>
</body>
</html>

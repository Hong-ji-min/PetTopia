<!doctype html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{layout/default}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>일정표</title>
</head>
<body>
<div class="container" layout:fragment="main">
    <section class="hero-wrap hero-wrap-2" style="background-image: url('/images/bg_2.jpg');" data-stellar-background-ratio="0.5">
        <div class="overlay"></div>
        <div class="container">
            <div class="row no-gutters slider-text align-items-end">
                <div class="col-md-9 ftco-animate pb-5">
                    <p class="breadcrumbs mb-2"><span class="mr-2"><a th:href="@{/}">Home  <i class="ion-ios-arrow-forward"></i></a></span>
                        <span>펫시터
							<i class="ion-ios-arrow-forward"></i>
						</span>
                    </p>
                    <h1 class="mb-0 bread">돌봄 리스트</h1>
                </div>
            </div>
        </div>
    </section>
    <table class="table" style="text-align: center">
        <thead>
        <tr>
            <th></th>
            <th>주문회원</th>
            <th>요청 날짜</th>
            <th>예약 날짜</th>
            <th>시작, 종료</th>
            <th>사이즈</th>
            <th>상태변경</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="sitting , stat : ${sittinglist}" th:object="${sitting}">
            [[${sitting}]]
            <form id="reservationForm" method="post" th:object="${sitting}">
                <label>
                    <input type="hidden" th:value="${sitting.partnerOrderId}" name="partnerOrderId">
                </label>
                <td>
                    <a th:href="@{|/petsitter/sittingdetail/${sitting.partnerOrderId}|}"
                       onclick="window.open(this.href, '_blank', 'left=2000%,top=800%, width=900, height=700'); return false;" >자세히</a>
                </td>
                <td><span th:text="${sitting.memberId}" name="memberId"></span></td>
                <td><span th:text="${#temporals.format(sitting.createdAt, 'yyyy-MM-dd/a hh:mm')}"
                          name="createdAt"></span></td>
                <td><span th:text="${sitting.serviceDate}" name="reservationDay"></span></td>
                <td>
                    <span th:text="${sitting.startTime}" name="startTime"></span>
                    <span th:text="${sitting.endTime}" name="endTime"></span>
                </td>
                <td>
                    <div th:each="sizehowmany:${sitting.petSizeAndHowManyPets}">
                        <span th:text="${sizehowmany.petSize}" name="petSize"></span>
                        <span th:text="${sizehowmany.howManyPet}"></span>
                    </div>
                </td>
                <td>
                    <div>
                        <span th:if="${sitting.sittingStatus.getSittingStatus()} == 'StandbySitting'"
                              th:text="돌봄대기"></span>
                        <span th:if="${sitting.sittingStatus.getSittingStatus()} == 'SITTING_STATUS'"
                              th:text="돌봄 중"></span>
                        <span th:if="${sitting.sittingStatus.getSittingStatus()} == 'COMPLETED_SITTING'"
                              th:text="돌봄 완료" id="completedSitting"></span>
                    </div>
                    <div>
                        <button type="submit" th:formaction="@{/petsitter/reservationOk}" class="btn"
                                th:if="${sitting.sittingStatus.getSittingStatus()} == 'StandbySitting'"
                                th:text="돌봄시작" id="startButton"></button>
                        <button type="submit" th:formaction="@{/petsitter/reservationOk}" class="btn"
                                th:if="${sitting.sittingStatus.getSittingStatus()} == 'SITTING_STATUS'"
                                th:text="돌봄완료" id="completeButton"></button>
                    </div>
                </td>
            </form>
        </tr>
        </tbody>
    </table>
    <script>
        window.onload = function () {
            // '돌봄 완료' 상태인지 확인합니다.
            const completedSittingSpan = document.getElementById('completedSitting');

            // 만약 '돌봄 완료' 상태가 존재하면, 버튼을 비활성화합니다.
            if (completedSittingSpan) {
                const startButton = document.getElementById('startButton');
                const completeButton = document.getElementById('completeButton');

                // 각 버튼이 존재할 경우 비활성화합니다.
                if (startButton) {
                    startButton.disabled = true;
                    startButton.classList.add("btn-disabled");  // 필요한 경우 스타일을 추가합니다.
                }

                if (completeButton) {
                    completeButton.disabled = true;
                    completeButton.classList.add("btn-disabled");  // 필요한 경우 스타일을 추가합니다.
                }
            }
        }
    </script>
</div>

</body>
</html>